# T-004: Domain - Transcript entities (VideoId, Chunk, Transcript)

| Campo | Valor |
|-------|-------|
| **Tamanho** | M |
| **Prioridade** | Must Have |
| **Epic** | Transcript |
| **Depende de** | T-002 |
| **TDD** | Obrigatorio (100%) |

---

## Contexto

Criar as entidades de dominio para Transcript seguindo DDD. Esta e a base para todo o sistema de transcricoes.

## Objetivo

Entidades de dominio Transcript completas com validacao, value objects e interfaces de repositorio.

## Escopo

- Value Object: VideoId (extrair ID de URL YouTube)
- Entity: Chunk (segmento de transcricao)
- Aggregate Root: Transcript (transcricao completa)
- Interface: TranscriptRepository
- Interface: TranscriptFetcher
- Result pattern para erros

## Arquivos a Criar

```
src/features/transcript/
├── domain/
│   ├── entities/
│   │   ├── transcript.ts
│   │   └── chunk.ts
│   ├── value-objects/
│   │   └── video-id.ts
│   ├── interfaces/
│   │   ├── transcript-repository.ts
│   │   └── transcript-fetcher.ts
│   └── errors/
│       └── transcript-errors.ts

tests/unit/features/transcript/
└── domain/
    ├── video-id.test.ts
    ├── chunk.test.ts
    └── transcript.test.ts
```

## Implementacao (TDD)

### 1. VideoId Value Object

```typescript
// PRIMEIRO: teste
// tests/unit/features/transcript/domain/video-id.test.ts
describe('VideoId', () => {
  it('should extract ID from youtube.com URL', () => {
    const videoId = VideoId.fromUrl('https://www.youtube.com/watch?v=abc123')
    expect(videoId.value).toBe('abc123')
  })

  it('should extract ID from youtu.be URL', () => {
    const videoId = VideoId.fromUrl('https://youtu.be/abc123')
    expect(videoId.value).toBe('abc123')
  })

  it('should reject invalid URL', () => {
    const result = VideoId.fromUrl('invalid')
    expect(result.isFailure).toBe(true)
  })
})

// DEPOIS: implementacao
// src/features/transcript/domain/value-objects/video-id.ts
```

### 2. Chunk Entity

```typescript
// PRIMEIRO: teste
describe('Chunk', () => {
  it('should create valid chunk', () => {
    const chunk = Chunk.create({
      index: 0,
      startTime: 0,
      endTime: 30,
      text: 'Hello world'
    })
    expect(chunk.isSuccess).toBe(true)
  })

  it('should reject negative times', () => {
    const chunk = Chunk.create({ startTime: -1, ... })
    expect(chunk.isFailure).toBe(true)
  })
})
```

### 3. Transcript Aggregate

```typescript
// PRIMEIRO: teste
describe('Transcript', () => {
  it('should create transcript with chunks', () => {
    const transcript = Transcript.create({
      videoId: VideoId.fromUrl('https://youtu.be/abc123').value,
      title: 'Test Video',
      chunks: [...]
    })
    expect(transcript.isSuccess).toBe(true)
  })
})
```

## Criterios de Aceite

- [ ] VideoId extrai ID de URLs youtube.com e youtu.be
- [ ] VideoId rejeita URLs invalidas
- [ ] Chunk valida tempos (startTime < endTime, nao negativos)
- [ ] Transcript e aggregate root com lista de Chunks
- [ ] Result pattern implementado para erros tipados
- [ ] Cobertura de testes: 100%
- [ ] Todos os testes passam

## Validacao

```bash
pnpm test tests/unit/features/transcript/domain/
pnpm test:coverage -- --coverage.include="src/features/transcript/domain/**"
```

---

## Tags de Contexto

```
PRD: features/transcript
ARQUITETURA: dominios/transcript, padroes
```

---

## Notas

- TDD OBRIGATORIO: Escrever teste ANTES do codigo
- Result pattern: Usar tipos para erros, nao exceptions
- Value Objects sao imutaveis
- Aggregate Root controla consistencia dos Chunks
